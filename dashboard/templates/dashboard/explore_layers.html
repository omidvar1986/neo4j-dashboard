{% extends 'dashboard/base.html' %}
{% block title %}Explore Layers - Neo4j Dashboard{% endblock %}
{% block extra_head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.19.0/cytoscape.min.js"></script>
    <style>
        .section { padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Vazir', sans-serif; }
        .btn { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        .btn:hover { background-color: #0056b3; }
        .error-message { color: #dc3545; margin-top: 10px; }
        #graph-container { width: 100%; height: 500px; border: 1px solid #ddd; border-radius: 4px; margin-top: 20px; }
    </style>
{% endblock %}
{% block content %}
    <div class="section">
        <h2>Explore Layers</h2>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="node_name">Node Name:</label>
                <input type="text" id="node_name" name="node_name" placeholder="Enter node name" value="{{ node_name|default_if_none:'' }}">
            </div>
            <div class="form-group">
                <label for="depth">Exploration Depth:</label>
                <select id="depth" name="depth">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <button type="submit" class="btn">Explore</button>
        </form>

        {% if error %}
            <div class="error-message">{{ error }}</div>
        {% endif %}

        {% if result_json %}
            <div id="graph-container"></div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const elements = {{ result_json|safe }};
                    const cy = cytoscape({
                        container: document.getElementById('graph-container'),
                        elements: elements,
                        style: [
                            {
                                selector: 'node',
                                style: {
                                    'label': 'data(label)',
                                    'background-color': '#28a745',
                                    'color': '#fff',
                                    'text-valign': 'center',
                                    'text-halign': 'center',
                                    'shape': 'ellipse',
                                    'width': '60px',
                                    'height': '60px',
                                    'font-family': 'Vazir, sans-serif'
                                }
                            },
                            {
                                selector: 'edge',
                                style: {
                                    'width': 2,
                                    'line-color': '#ccc',
                                    'target-arrow-color': '#ccc',
                                    'target-arrow-shape': 'triangle',
                                    'curve-style': 'bezier',
                                    'label': 'data(label)',
                                    'font-family': 'Vazir, sans-serif'
                                }
                            }
                        ],
                        layout: {
                            name: 'cose',
                            idealEdgeLength: 100,
                            nodeRepulsion: 400000,
                            gravity: 0.25
                        }
                    });
                });
            </script>
        {% endif %}
    </div>
{% endblock %}